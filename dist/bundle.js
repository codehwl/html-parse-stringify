const e=/[a-zA-Z0-9!]/,t=/\s/,n=/[^<>]/;var r={parse:(r,o={})=>{const l=function(r){const o=[];let l=0,s="",i="",a=!1;for(;l<r.length;){let u=r[l];if("<"!==u&&"/"!==u&&">"!==u){if("<"===s&&"!"===u){let e="";for(;!t.test(u)&&">"!==u;)e+=u,u=r[++l];if("!DOCTYPE"===e){for(e+=" ",u=r[++l];">"!==u;)e+=u,u=r[++l];o.push({type:"doctype",value:`<${e}>`});continue}if(e.startsWith("!--")){for(;!e.endsWith("--\x3e");)e+=u,u=r[++l];const t=e.match(/!--\s*(.*?)\s*--/);let n="";t&&t[1]&&(n=t[1]),o.push({type:"comment",value:n||""});continue}}if("/"!==s&&"<"!==s||!e.test(u))if(t.test(u))l++,s=u;else if(a||!n.test(u)){if(!a)throw new TypeError(`[html-parse-stringify] Unknow char: '${u}'`);{let e="",n="";for(;"="!==u&&!t.test(u)&&">"!==u;)e+=u,u=r[++l];if("="===u){u=r[++l];let e="";for('"'!==u&&"'"!==u||(e=u,u=r[++l]);u!==e;)n+=u,u=r[++l];e&&l++}else n=!0;o.push({type:"attribute",value:{[e]:n}}),s=u}}else{let e="";for(;l<r.length&&n.test(u);)e+=u,u=r[++l];o.push({type:"text",value:e}),s=u}else{let t="";for(;l<r.length&&e.test(u);)t+=u,u=r[++l];const n=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"].includes(t.toLowerCase())?"self-closing-tag":"<"===i?"tag":"end-tag";o.push({type:n,value:t}),s=u,a=!0}}else i=u,s=u,a=!1,l++}return o}(r);o.logTokens&&(console.log("---------- TOKENS START ----------"),console.log(l),console.log("---------- TOKENS END ----------"));const s=function(e){let t=0;function n(){let r=e[t];if(r){if("doctype"===r.type)return t++,{type:"doctype",value:r.value};if("comment"===r.type)return t++,{type:"comment",value:r.value};if("tag"===r.type||"self-closing-tag"===r.type){const o={type:"element",name:r.value,attributes:{},children:[],isVoidElement:"self-closing-tag"===r.type};for(r=e[++t];r&&"attribute"===r.type;)o.attributes=Object.assign(o.attributes,r.value),r=e[++t];if(o.isVoidElement)return o;if(r&&"end-tag"===r.type)t++;else{let e=n();for(;e;)o.children.push(e),e=n();t++}return o}if("text"===r.type)return t++,{type:"text",value:r.value};if("end-tag"!==r.type)throw new TypeError(`Unknow token: '${r.value}'`)}}const r={type:"root",children:[]};for(;t<e.length;)r.children.push(n());return r}(l);return s},stringify:function e(t){if("root"===t.type)return t.children.map(e).join("");if("doctype"===t.type)return t.value;if("comment"===t.type)return`\x3c!-- ${t.value} --\x3e`;if("text"===t.type)return t.value;if("element"===t.type){let n="";for(const e in t.attributes)n+=` ${e}="${t.attributes[e]}"`;const r=t.children.map(e).join("");return`<${t.name}${n}>${r}</${t.name}>`}}};export{r as default};
